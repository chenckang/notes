# URI

URI中文全称为**统一资源标识符**，其具体作用就是用于定位资源所在的位置。URI存在2类子集——URL及URN。HTTP仅处理URI中的URL子集。

## URL

### URL简介

URL全称统一资源定位符，且几乎所有的URI都是URL。URL提供定位因特网上所有资源的方式。存在多种不同的URL方案，每种方案的语法又不尽相同。通用的URL语法如下：
    
    <scheme>://<user>:<password>@<host>:<port>/<path>;<param>?<query>#<frag>

其中**param**为参数组件，例如：ftp://host/path;b=1/to;c=2/，一般而言用于针对路径所指向资源的增加额外约束条件，以返回资源的不同形态。

其中共含有九个组件，但是并不存在一种特定的URL完全包含上面的所有组件，一般仅仅包含其中的几个部分而已。

### 相对URL

在html文档中，超链接可以表现为2中形式，相对URL和绝对URL。首先HTTP客户端对资源的访问必须知道资源的确切位置，因而相对URL会被解析为绝对URL再进行资源访问，其解析的依据就是基础URL。

有几种方式可以提供基础URL：

* 使用HTML的**<base>**标签来显示的指定
* 已当前文档的URL为基准进行解析

相对URL不仅仅指的是仅有路径形式的URL，例如，没有**scheme**、仅存在**path**、仅存在**query**等都是相对的URL。

针对相对URL的解析的算法如下（带解析的URL已是相对URL）：

* 相对URL的所有组件都为空，则采纳全部的基础URL组件（注，现代浏览器针对**script**及**img**标签进行了优化，如果未指定相对URL，则不加载任何内容）
* 相对URL的**scheme**为空，则采纳基础URL的**scheme**，同时检查**user**、**password**、**host**、**port**组件
* 上一条中，如果所有的组件都为空，则继承基础URL中的这些组件，并检查**path**组件，否则解析结束，返回最终URL。
* 继续检查**path**组件，
    * 如果相对URL中的**path**是绝对路径（即以“/”开头），则**path**部分绝对处理。解析结束，返回最终URL
    * 如果相对URL中的**path**是相对路径（以“./”或其他字符开头），则相对于当前的基础URL的**path**部分做处理，解析结束返回最终的URL。
    * 如果**path**为空，则继承基础URL中的**path**，继续处理**param**
* 继续检查**param**组件，
    * 如果**param**非空，解析结束返回最终的URL
    * 如果**param**为空，则继承基础URL中的**param**，并继续解析**query**
* 继续检查**query**，
    * 如果**query**非空，解析结束返回最终的URL
    * 如果**query**为空，则继承基础URL中的**query**，并返回最终的URL

例如：我们尝试解析下**?a=1**相对URL，基础URL为**http://host:8080/c?d=1**
* 首先，**scheme**为空，则继承**scheme**，得到第一个组件：**http**
* 其次，**host**、**port**为空，则继承**host**及**port**, 得到**http://host:8080**
* 然后，**path**为空，继承**path**, 得到**http://host:8080/c**
* 最后，**query**不为空，则将**query**和目前抽取到的基础URL进行组合，得到**http://host:8080/c?a=1**，解析结束

### URL字符

URL的字符集采用以英语为中心的US-ASCⅡ，但是对于非英语字符集以及URL中保留/受限的字符，URL采用***转义字符序列***的方式来实现支持。

#### 转义字符编码

表现形式为，一个百分号（%），后面跟着两个十六进制字符：%FF。

例如，常见的空格会被编码为：%20，由于其ASCⅡ编码为32（0x20），汉字采用的编码为unicode（由于unicode兼容ASCⅡ，亦可以认为基于unicode进行转移）

#### 保留/限制字符

保留和限制的字符存在两种情况：其一，不可代印字符；其二，协议相关的功能字符。

列表如下：

|| *字符* || *受限/保留原因* ||
|| % || 转移标志 ||
|| / || **path**分隔 ||
|| . || **path**组件中使用 ||
|| .. || **path**组件中使用，代表上一个目录 ||
|| # || **frag**组件中的分隔符 ||
|| ? || **query**组件风格符 ||
|| ; || **param**组件分隔符 ||
|| : || **user**, **password**分隔符及**host**, **port**分隔符||
|| $ , + || 保留 ||
|| @ & = || 存在特殊含义 ||
|| {}|\^~[]' || 受用受限，各种网管的不安全处理 ||
|| <>" || URL之外存在含义，使用受限 ||
|| 0x00-0x1F, 0x7F || 在不可打印字符范围内 ||
|| >0x7F || 不在US-ASCⅡ的范围内 ||

参见 **encodeURI**/**encodeURIComponent**

#### scheme

常见的**scheme**如下：

|| *scheme* || *描述* ||
|| http || 格式诸如：scheme://host:port/path?query#frag ||
|| https || 使用SSL加密的http，默认端口443，格式如http ||
|| mailto || 由于email的行为与其他的schema不同，所以其格式也有一定的差别，格式如下：mailto:<RFC-822-addr-spec> ||
|| ftp || 文本传输协议，格式诸如：scheme://user@password@host:port/path:params ||
|| rtsp, rtspu || 实时流传输协议，用于解析音频视频，格式同ftp ||
|| file || 通过磁盘，网络文件系统等访问，格式：file://host/path/，例如，file://OFFICE-FS/abc.doc ||
|| news || 用于访问特定的文章或者新闻组，其URL中没有主机名，需通过客户端指定服务器位置 ||
|| telnet || 交互式业务，格式：telnet://user:password@host:port/ ||



## URN

URN全称统一资源名。URL存在可能失效的情况，即资源被转移走，IETF提出了URN来解决这个问题。一种基于URL的URN实现方式为：永久统一资源定位符（PURL），解决方式就是给资源命名并通过中间服务器来存储资源位置，则无论资源被移到何处，都能够通过资源名经过中间服务器来定位。

例如，RFC 2141文档的用URN的表示方法：urn:ietf:rfc:2141。无论该文档位于何处，使用和URL表示，URN表示法都可以定位到该文档。

很显然，URN并不能满足互联网爆发式发展，首先资源命名及更改资源映射就十分艰难，解析URN的基础设施建设过于复杂，其命名方式对普通用户并不友好，并且URL及其重定向辅助技术甚至当今的搜索引擎技术已经完全满足了资源转移的问题解决，最终要的是解决方案掌握在高度灵活的厂商手中，而不是缓慢的机构。预计URN并不会被大规模采纳，所以我们只需要了解下URN及其设计思想即可。
